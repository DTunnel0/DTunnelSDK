<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DTunnel SDK Example</title>
  <style>
    :root {
      --bg: #101828;
      --card: #0b1220;
      --card-2: #111827;
      --line: #233044;
      --text: #dbe7ff;
      --muted: #92a3bc;
      --accent: #4cc9f0;
      --ok: #38b000;
      --warn: #ffb703;
      --bad: #ef476f;
    }

    * {
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 95% -10%, #1f3b73 0%, transparent 60%),
        radial-gradient(900px 400px at -10% 110%, #0f766e 0%, transparent 60%),
        var(--bg);
      padding: 18px;
    }

    .shell {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 14px;
    }

    .card {
      background: linear-gradient(160deg, var(--card), var(--card-2));
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px;
    }

    h1 {
      margin: 0;
      font-size: 23px;
    }

    h2 {
      margin: 0 0 10px;
      font-size: 16px;
      color: var(--accent);
    }

    p {
      margin: 10px 0 0;
      color: var(--muted);
    }

    .state {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .pill {
      border: 1px solid var(--line);
      border-radius: 100px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--muted);
      background: rgba(0, 0, 0, 0.2);
    }

    .pill.ok {
      color: var(--ok);
    }

    .pill.warn {
      color: var(--warn);
    }

    .pill.bad {
      color: var(--bad);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 8px;
    }

    button {
      border: 1px solid var(--line);
      border-radius: 10px;
      color: var(--text);
      background: #0a1323;
      padding: 10px;
      cursor: pointer;
      transition: transform 120ms ease, border-color 120ms ease;
    }

    button:hover {
      transform: translateY(-1px);
      border-color: var(--accent);
    }

    pre {
      margin: 0;
      min-height: 290px;
      max-height: 460px;
      overflow: auto;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #030916;
      color: #c5d6f3;
      padding: 12px;
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <div class="shell">
    <section class="card">
      <h1>DTunnel SDK Integration Example</h1>
      <p>Exemplo completo usando o SDK wrapper da bridge nativa do WebView.</p>
      <div class="state">
        <span id="sdkStatus" class="pill">SDK: carregando...</span>
        <span id="bridgeStatus" class="pill">Bridge: verificando...</span>
        <span id="vpnStatus" class="pill">VPN: desconhecido</span>
      </div>
    </section>

    <section class="card">
      <h2>Acoes</h2>
      <div class="grid">
        <button id="btnGetVpnState">sdk.main.getVpnState()</button>
        <button id="btnStartVpn">sdk.main.startVpn()</button>
        <button id="btnStopVpn">sdk.main.stopVpn()</button>
        <button id="btnGetConfigs">sdk.config.getConfigs()</button>
        <button id="btnGetLogs">sdk.main.getLogs()</button>
        <button id="btnClearLogs">sdk.main.clearLogs()</button>
        <button id="btnCheckUser">sdk.main.startCheckUser()</button>
        <button id="btnAppVersion">sdk.android.getAppVersion()</button>
        <button id="btnSnapshot">sdk.createDebugSnapshot()</button>
      </div>
    </section>

    <section class="card">
      <h2>Output</h2>
      <pre id="output"></pre>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/gh/DTunnel0/DTunnelSDK@main/sdk/dtunnel-sdk.js"></script>
  <script>
    (function () {
      const output = document.getElementById("output");
      const sdkStatus = document.getElementById("sdkStatus");
      const bridgeStatus = document.getElementById("bridgeStatus");
      const vpnStatus = document.getElementById("vpnStatus");

      function log(type, message, data) {
        const suffix = data === undefined ? "" : " " + safeStringify(data);
        output.textContent += "[" + new Date().toISOString() + "] [" + type + "] " + message + suffix + "\n";
        output.scrollTop = output.scrollHeight;
      }

      function safeStringify(value) {
        try {
          if (typeof value === "string") return value;
          return JSON.stringify(value, null, 2);
        } catch (error) {
          return String(value);
        }
      }

      if (typeof window.DTunnelSDK !== "function") {
        sdkStatus.textContent = "SDK: nao carregado";
        sdkStatus.className = "pill bad";
        log("ERROR", "Arquivo do SDK nao foi carregado.");
        return;
      }

      sdkStatus.textContent = "SDK: pronto";
      sdkStatus.className = "pill ok";

      const sdk = new window.DTunnelSDK({
        strict: false,
        autoRegisterNativeEvents: true,
      });

      window.__dtunnelSdk = sdk;

      function refreshBridgeStatus() {
        const availability = sdk.getBridgeAvailability();
        const required = ["DtGetVpnState", "DtExecuteVpnStart", "DtExecuteVpnStop"];
        const missing = required.filter((name) => !availability[name]);

        if (missing.length === 0) {
          bridgeStatus.textContent = "Bridge: pronta";
          bridgeStatus.className = "pill ok";
          return;
        }

        bridgeStatus.textContent = "Bridge: parcial (" + missing.join(", ") + ")";
        bridgeStatus.className = "pill warn";
      }

      function setVpnStatus(state) {
        vpnStatus.textContent = "VPN: " + (state || "desconhecido");
      }

      sdk.on("error", (event) => {
        log("SDK_ERROR", event.error.message, event.error.details);
      });

      sdk.on("nativeEvent", (event) => {
        log("EVENT", event.callbackName, event.payload);
      });

      sdk.on("vpnState", (event) => {
        setVpnStatus(event.payload);
      });

      document.getElementById("btnGetVpnState").addEventListener("click", () => {
        const state = sdk.main.getVpnState();
        setVpnStatus(state);
        log("CALL", "sdk.main.getVpnState()", state);
      });

      document.getElementById("btnStartVpn").addEventListener("click", () => {
        sdk.main.startVpn();
        log("CALL", "sdk.main.startVpn()");
      });

      document.getElementById("btnStopVpn").addEventListener("click", () => {
        sdk.main.stopVpn();
        log("CALL", "sdk.main.stopVpn()");
      });

      document.getElementById("btnGetConfigs").addEventListener("click", () => {
        const configs = sdk.config.getConfigs();
        log("CALL", "sdk.config.getConfigs()", configs);
      });

      document.getElementById("btnGetLogs").addEventListener("click", () => {
        const logs = sdk.main.getLogs();
        log("CALL", "sdk.main.getLogs()", logs);
      });

      document.getElementById("btnClearLogs").addEventListener("click", () => {
        sdk.main.clearLogs();
        log("CALL", "sdk.main.clearLogs()");
      });

      document.getElementById("btnCheckUser").addEventListener("click", () => {
        sdk.main.startCheckUser();
        log("CALL", "sdk.main.startCheckUser()");
      });

      document.getElementById("btnAppVersion").addEventListener("click", () => {
        const version = sdk.android.getAppVersion();
        log("CALL", "sdk.android.getAppVersion()", version);
      });

      document.getElementById("btnSnapshot").addEventListener("click", () => {
        log("DEBUG", "sdk.createDebugSnapshot()", sdk.createDebugSnapshot());
      });

      refreshBridgeStatus();
      const initialState = sdk.main.getVpnState();
      setVpnStatus(initialState);
      log("INFO", "SDK inicializado");
    })();
  </script>
</body>
</html>
