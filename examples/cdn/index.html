<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DTunnel SDK - Exemplo CDN Completo</title>
  <style>
    :root {
      --bg: #0c1220;
      --panel: #111a2f;
      --panel-2: #17233f;
      --line: #2c3c66;
      --text: #d8e3ff;
      --muted: #9fb0d6;
      --ok: #47c17a;
      --warn: #ffc453;
      --error: #ff6464;
      --accent: #66d9ef;
    }

    * {
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      background:
        radial-gradient(1000px 420px at 0% 0%, #21407b 0%, transparent 60%),
        radial-gradient(800px 380px at 100% 100%, #1f4f5e 0%, transparent 60%),
        var(--bg);
      padding: 18px;
    }

    .shell {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 12px;
    }

    .card {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: linear-gradient(160deg, var(--panel), var(--panel-2));
      padding: 14px;
    }

    h1 {
      margin: 0;
      font-size: 22px;
    }

    h2 {
      margin: 0 0 10px;
      font-size: 16px;
      color: var(--accent);
    }

    p {
      margin: 8px 0 0;
      color: var(--muted);
    }

    .pills {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .pill {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--muted);
      background: rgba(0, 0, 0, 0.2);
    }

    .ok { color: var(--ok); }
    .warn { color: var(--warn); }
    .error { color: var(--error); }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 8px;
    }

    button {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #0a1429;
      color: var(--text);
      padding: 10px;
      cursor: pointer;
      transition: 120ms ease;
    }

    button:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    pre {
      margin: 0;
      min-height: 280px;
      max-height: 480px;
      overflow: auto;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #030a16;
      color: #c8d8ff;
      padding: 12px;
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <div class="shell">
    <section class="card">
      <h1>DTunnel SDK - JavaScript via CDN</h1>
      <p>Exemplo completo com monitor de eventos, diagnostico de bridge e chamadas principais.</p>
      <div class="pills">
        <span id="sdkStatus" class="pill">SDK: carregando...</span>
        <span id="bridgeStatus" class="pill">Bridge: verificando...</span>
        <span id="vpnStatus" class="pill">VPN: desconhecido</span>
      </div>
    </section>

    <section class="card">
      <h2>Acoes</h2>
      <div class="grid">
        <button id="btnGetVpnState">sdk.main.getVpnState()</button>
        <button id="btnStartVpn">sdk.main.startVpn()</button>
        <button id="btnStopVpn">sdk.main.stopVpn()</button>
        <button id="btnGetConfigs">sdk.config.getConfigs()</button>
        <button id="btnGetDefault">sdk.config.getDefaultConfig()</button>
        <button id="btnGetLogs">sdk.main.getLogs()</button>
        <button id="btnCheckUser">sdk.main.startCheckUser()</button>
        <button id="btnGetVersion">sdk.android.getAppVersion()</button>
        <button id="btnGetNetwork">sdk.android.getNetworkData()</button>
        <button id="btnSnapshot">sdk.createDebugSnapshot()</button>
      </div>
    </section>

    <section class="card">
      <h2>Output</h2>
      <pre id="output"></pre>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/gh/DTunnel0/DTunnelSDK@main/sdk/dtunnel-sdk.js"></script>
  <script>
    (function () {
      const output = document.getElementById("output");
      const sdkStatus = document.getElementById("sdkStatus");
      const bridgeStatus = document.getElementById("bridgeStatus");
      const vpnStatus = document.getElementById("vpnStatus");

      function log(type, message, data) {
        const suffix = data === undefined ? "" : " " + safeStringify(data);
        output.textContent += "[" + new Date().toISOString() + "] [" + type + "] " + message + suffix + "\n";
        output.scrollTop = output.scrollHeight;
      }

      function safeStringify(value) {
        try {
          if (typeof value === "string") return value;
          return JSON.stringify(value, null, 2);
        } catch (_error) {
          return String(value);
        }
      }

      function markClass(element, mode) {
        element.classList.remove("ok", "warn", "error");
        if (mode) element.classList.add(mode);
      }

      if (typeof window.DTunnelSDK !== "function") {
        sdkStatus.textContent = "SDK: nao carregado";
        markClass(sdkStatus, "error");
        log("ERROR", "Nao foi possivel carregar dtunnel-sdk.js");
        return;
      }

      const sdk = new window.DTunnelSDK({
        strict: false,
        autoRegisterNativeEvents: true,
      });

      window.__dtunnelSdk = sdk;

      sdkStatus.textContent = "SDK: pronto (v" + sdk.version + ")";
      markClass(sdkStatus, "ok");

      function refreshBridgeStatus() {
        const availability = sdk.getBridgeAvailability();
        const required = ["DtGetVpnState", "DtExecuteVpnStart", "DtExecuteVpnStop"];
        const missing = required.filter(function (name) {
          return !availability[name];
        });

        if (missing.length === 0) {
          bridgeStatus.textContent = "Bridge: pronta";
          markClass(bridgeStatus, "ok");
          return;
        }

        bridgeStatus.textContent = "Bridge: parcial (" + missing.join(", ") + ")";
        markClass(bridgeStatus, "warn");
      }

      function setVpnStatus(state) {
        vpnStatus.textContent = "VPN: " + (state || "desconhecido");
      }

      sdk.on("error", function (event) {
        log("SDK_ERROR", event.error.message, event.error.details);
      });

      sdk.on("nativeEvent", function (event) {
        log("EVENT", event.callbackName, event.payload);
      });

      sdk.on("vpnState", function (event) {
        setVpnStatus(event.payload);
      });

      document.getElementById("btnGetVpnState").addEventListener("click", function () {
        const state = sdk.main.getVpnState();
        setVpnStatus(state);
        log("CALL", "sdk.main.getVpnState()", state);
      });

      document.getElementById("btnStartVpn").addEventListener("click", function () {
        sdk.main.startVpn();
        log("CALL", "sdk.main.startVpn()");
      });

      document.getElementById("btnStopVpn").addEventListener("click", function () {
        sdk.main.stopVpn();
        log("CALL", "sdk.main.stopVpn()");
      });

      document.getElementById("btnGetConfigs").addEventListener("click", function () {
        const result = sdk.config.getConfigs();
        log("CALL", "sdk.config.getConfigs()", result);
      });

      document.getElementById("btnGetDefault").addEventListener("click", function () {
        const result = sdk.config.getDefaultConfig();
        log("CALL", "sdk.config.getDefaultConfig()", result);
      });

      document.getElementById("btnGetLogs").addEventListener("click", function () {
        const result = sdk.main.getLogs();
        log("CALL", "sdk.main.getLogs()", result);
      });

      document.getElementById("btnCheckUser").addEventListener("click", function () {
        sdk.main.startCheckUser();
        log("CALL", "sdk.main.startCheckUser()");
      });

      document.getElementById("btnGetVersion").addEventListener("click", function () {
        const result = sdk.android.getAppVersion();
        log("CALL", "sdk.android.getAppVersion()", result);
      });

      document.getElementById("btnGetNetwork").addEventListener("click", function () {
        const result = sdk.android.getNetworkData();
        log("CALL", "sdk.android.getNetworkData()", result);
      });

      document.getElementById("btnSnapshot").addEventListener("click", function () {
        log("DEBUG", "sdk.createDebugSnapshot()", sdk.createDebugSnapshot());
      });

      refreshBridgeStatus();
      setVpnStatus(sdk.main.getVpnState());
      log("INFO", "Exemplo CDN inicializado");
    })();
  </script>
</body>
</html>
